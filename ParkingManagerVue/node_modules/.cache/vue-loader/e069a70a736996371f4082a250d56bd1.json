{"remainingRequest":"F:\\IdeaProjects\\ParkingManagerVue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\IdeaProjects\\ParkingManagerVue\\src\\components\\person\\UserInfo.vue?vue&type=style&index=0&id=286af153&scoped=true&lang=css","dependencies":[{"path":"F:\\IdeaProjects\\ParkingManagerVue\\src\\components\\person\\UserInfo.vue","mtime":1696068433429},{"path":"F:\\IdeaProjects\\ParkingManagerVue\\node_modules\\css-loader\\dist\\cjs.js","mtime":1720454233855},{"path":"F:\\IdeaProjects\\ParkingManagerVue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1720454234910},{"path":"F:\\IdeaProjects\\ParkingManagerVue\\node_modules\\postcss-loader\\src\\index.js","mtime":1720454234264},{"path":"F:\\IdeaProjects\\ParkingManagerVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1720454233480},{"path":"F:\\IdeaProjects\\ParkingManagerVue\\node_modules\\vue-loader\\lib\\index.js","mtime":1720454234585}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQojbXlDaGFydCB7DQogICAgd2lkdGg6IDUwMHB4Ow0KICAgIGhlaWdodDogNDUwcHg7DQp9DQojY2hhcnQyIHsNCiAgICB3aWR0aDogNTAwcHg7DQogICAgaGVpZ2h0OiA0NTBweDsNCn0NCi5oMi10ZXh0IHsNCiAgICBjb2xvcjogcmdiKDcwLCA3MCwgNzApOw0KICAgIGZvbnQtc2l6ZTogMThweDsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQp9DQouZGF0YS10ZXh0IHsNCiAgICB3aWR0aDogMTAwJTsNCiAgICBoZWlnaHQ6IDE1MHB4Ow0KICAgIGxpbmUtaGVpZ2h0OiAxNTBweDsNCiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgY29sb3I6IHJnYigyMDMsIDE5OSwgMTk5KTsNCiAgICBmb250LXNpemU6IDI0cHg7DQp9DQo="},{"version":3,"sources":["UserInfo.vue"],"names":[],"mappings":";AAyaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"UserInfo.vue","sourceRoot":"src/components/person","sourcesContent":["<!--\r\n * @Description: \r\n * @Author: Rabbiter\r\n * @Date: 2022-07-03 12:17:07\r\n-->\r\n<template>\r\n    <div>\r\n        <el-breadcrumb separator-class=\"el-icon-arrow-right\">\r\n            <el-breadcrumb-item\r\n                ><i\r\n                    class=\"iconfont icon-r-user1\"\r\n                    style=\"margin: 5px; font-size: 22px\"\r\n                >\r\n                    个人信息</i\r\n                ></el-breadcrumb-item\r\n            >\r\n        </el-breadcrumb>\r\n\r\n        <!-- 卡片视图区域 -->\r\n        <el-card>\r\n            <el-row :gutter=\"20\">\r\n                <el-col :span=\"24\">\r\n                    <div class=\"grid-content bg-purple\">\r\n                        <el-button\r\n                            type=\"primary\"\r\n                            @click=\"updateUser\"\r\n                            style=\"font-size: 18px\"\r\n                        >\r\n                           <i class=\"iconfont icon-r-edit\"  style=\"font-size: 22px;\"></i>  修改信息</el-button\r\n                        >\r\n                    </div>\r\n                </el-col>\r\n            </el-row>\r\n            <hr />\r\n            <el-row :gutter=\"20\">\r\n                <el-col :span=\"16\">\r\n                    <div class=\"grid-content bg-purple\">\r\n                        <h2>个人基本信息</h2>\r\n                    </div>\r\n                </el-col>\r\n            </el-row>\r\n            <el-row :gutter=\"20\">\r\n                <el-col :span=\"4\"\r\n                    ><div class=\"grid-content bg-purple\">\r\n                        用户名：{{ userInfo.username }}\r\n                    </div></el-col\r\n                >\r\n                <el-col :span=\"5\"\r\n                    ><div class=\"grid-content bg-purple\">\r\n                        姓名：{{ userInfo.nike }}\r\n                    </div></el-col\r\n                >\r\n                <el-col :span=\"5\"\r\n                    ><div class=\"grid-content bg-purple\">\r\n                        联系电话：{{ userInfo.phone }}\r\n                    </div></el-col\r\n                >\r\n                <el-col :span=\"4\"\r\n                    ><div class=\"grid-content bg-purple\">\r\n                        年龄：{{ userInfo.age }}岁\r\n                    </div></el-col\r\n                >\r\n            </el-row>\r\n            <br />\r\n            <el-row :gutter=\"20\">\r\n                <el-col :span=\"4\"\r\n                    ><div class=\"grid-content bg-purple\">\r\n                        性别：{{ userInfo.sex }}\r\n                    </div></el-col\r\n                >\r\n                <el-col :span=\"5\"\r\n                    ><div class=\"grid-content bg-purple\">\r\n                        车牌号：{{ userInfo.card }}\r\n                    </div></el-col\r\n                >\r\n            </el-row>\r\n            <br />\r\n            <hr />\r\n            <el-row :gutter=\"20\">\r\n                <el-col :span=\"10\">\r\n                    <div v-if=\"!dataTypeShow\" class=\"data-type\">\r\n                        <h2 class=\"h2-text\">停车类型记录</h2>\r\n                        <div class=\"data-text\">没有相关记录</div>\r\n                    </div>\r\n                    <div\r\n                        v-show=\"dataTypeShow\"\r\n                        class=\"grid-content bg-purple\"\r\n                        id=\"myChart\"\r\n                    ></div>\r\n                </el-col>\r\n                <el-col :span=\"10\">\r\n                    <div class=\"grid-content bg-purple\" id=\"chart2\"></div>\r\n                </el-col>\r\n            </el-row>\r\n        </el-card>\r\n        <el-dialog\r\n            title=\"修改信息\"\r\n            :visible.sync=\"editShow\"\r\n            width=\"50%\"\r\n            center\r\n            @close=\"editClose\"\r\n        >\r\n            <!-- 内容主题区域 -->\r\n            <el-form\r\n                :model=\"editUser\"\r\n                :rules=\"editRules\"\r\n                ref=\"editRules\"\r\n                label-width=\"80px\"\r\n            >\r\n                <el-form-item label=\"姓名\" prop=\"nike\">\r\n                    <el-input v-model=\"editUser.nike\"></el-input>\r\n                </el-form-item>\r\n                <el-form-item label=\"密码\" prop=\"password\">\r\n                    <el-input v-model=\"editUser.password\"></el-input>\r\n                </el-form-item>\r\n                <el-form-item label=\"车牌号\" prop=\"card\">\r\n                    <el-input v-model=\"editUser.card\"></el-input>\r\n                </el-form-item>\r\n                <el-form-item label=\"联系电话\" prop=\"phone\">\r\n                    <el-input v-model=\"editUser.phone\"></el-input>\r\n                </el-form-item>\r\n                <el-form-item label=\"性别\">\r\n                    <template>\r\n                        <el-radio v-model=\"editUser.sex\" label=\"男\"\r\n                            >男</el-radio\r\n                        >\r\n                        <el-radio v-model=\"editUser.sex\" label=\"女\"\r\n                            >女</el-radio\r\n                        >\r\n                    </template>\r\n                </el-form-item>\r\n            </el-form>\r\n\r\n            <!-- 底部区域 -->\r\n            <span slot=\"footer\" class=\"dialog-footer\">\r\n                <el-button @click=\"editClose()\" style=\"font-size: 18px;\"><i class=\"iconfont icon-r-left\" style=\"font-size: 22px;\"></i> 取消</el-button>\r\n                <el-button type=\"primary\" @click=\"editCommit('editRules')\"\r\n                    style=\"font-size: 18px;\"><i class=\"iconfont icon-r-yes\" style=\"font-size: 22px;\"></i> 确认修改</el-button\r\n                >\r\n            </span>\r\n        </el-dialog>\r\n    </div>\r\n</template>\r\n<script>\r\nimport axios from \"axios\";\r\n\r\nexport default {\r\n    data() {\r\n        var checkAge = (rule, value, callback) => {\r\n            if (!value) {\r\n                return callback(new Error(\"年龄不能为空\"));\r\n            }\r\n            setTimeout(() => {\r\n                if (!Number.isInteger(value)) {\r\n                    callback(new Error(\"请输入数字值\"));\r\n                } else {\r\n                    if (value < 18) {\r\n                        callback(new Error(\"必须年满18岁\"));\r\n                    } else {\r\n                        callback();\r\n                    }\r\n                }\r\n            }, 1000);\r\n        };\r\n        var validatePass2 = (rule, value, callback) => {\r\n            if (value === \"\") {\r\n                callback(new Error(\"请再次输入密码\"));\r\n            } else if (value !== this.editUser.password) {\r\n                callback(new Error(\"两次输入密码不一致!\"));\r\n            } else {\r\n                callback();\r\n            }\r\n        };\r\n        return {\r\n            userInfo: {},\r\n            editUser: {\r\n                password: \"\",\r\n                age: \"\",\r\n                sex: \"\",\r\n                phone: \"\",\r\n                card: \"\",\r\n                nike: \"\",\r\n            },\r\n            editShow: false,\r\n            dataTypes: [],\r\n            dataMoneyName: [],\r\n            dataMoneyValue: [],\r\n            dataTypeShow: false,\r\n            editRules: {\r\n                password: [\r\n                    { required: true, message: \"请输入密码\", trigger: \"blur\" },\r\n                    {\r\n                        min: 6,\r\n                        max: 15,\r\n                        message: \"长度在 6 到 15 个字符\",\r\n                        trigger: \"blur\",\r\n                    },\r\n                ],\r\n                check: [{ validator: validatePass2, trigger: \"blur\" }],\r\n                age: [{ validator: checkAge, trigger: \"blur\" }],\r\n                nike: [\r\n                    { required: true, message: \"请输入姓名\", trigger: \"blur\" },\r\n                ],\r\n                phone: [\r\n                    {\r\n                        required: true,\r\n                        message: \"请输入联系电话\",\r\n                        trigger: \"blur\",\r\n                    },\r\n                ],\r\n                card: [\r\n                    {\r\n                        required: true,\r\n                        message: \"请输入车牌号\",\r\n                        trigger: \"blur\",\r\n                    },\r\n                ],\r\n            },\r\n        };\r\n    },\r\n    methods: {\r\n        getUserInfo(uid) {\r\n            axios.get(\"/api/user/getUserByUid?uid=\" + uid).then((res) => {\r\n                this.userInfo = res.data.data;\r\n                this.getUserDataType(this.userInfo.username);\r\n                this.getUserDataMoney(this.userInfo.username);\r\n            });\r\n        },\r\n        getUserDataType(person) {\r\n            axios.get(\"/api/user/dataType?person=\" + person).then((res) => {\r\n                this.dataTypes = res.data.data;\r\n                if (this.dataTypes.length > 0) {\r\n                    this.dataTypeShow = true;\r\n                    this.draw1();\r\n                } else {\r\n                    this.dataTypeShow = false;\r\n                }\r\n            });\r\n        },\r\n        getUserDataMoney(person) {\r\n            axios.get(\"/api/user/dataMoney?person=\" + person).then((res) => {\r\n                this.dataMoneyName = [];\r\n                this.dataMoneyValue = [];\r\n                console.log(res.data);\r\n                if (res.data.data.length > 0) {\r\n                    for (let i = 0; i < res.data.data.length; i++) {\r\n                        if (res.data.data[i] != null) {\r\n                            this.dataMoneyName.push(\r\n                                this.dateFormat(res.data.data[i].name, 2)\r\n                            );\r\n                            this.dataMoneyValue.push(res.data.data[i].value);\r\n                        }\r\n                    }\r\n                    this.draw2();\r\n                }\r\n            });\r\n        },\r\n        updateUser() {\r\n            this.editUser.phone = this.userInfo.phone;\r\n            this.editUser.age = this.userInfo.age;\r\n            this.editUser.sex = this.userInfo.sex;\r\n            this.editUser.card = this.userInfo.card;\r\n            this.editUser.password = this.userInfo.password;\r\n            this.editUser.nike = this.userInfo.nike;\r\n            this.editShow = true;\r\n        },\r\n        editClose() {\r\n            this.editShow = false;\r\n        },\r\n        draw1() {\r\n            var echarts = require(\"echarts\");\r\n            var myChart = echarts.init(document.getElementById(\"myChart\"));\r\n            var option = {\r\n                title: {\r\n                    text: \"停车类型记录\",\r\n                    left: \"center\",\r\n                },\r\n                tooltip: {\r\n                    trigger: \"item\",\r\n                },\r\n                legend: {\r\n                    orient: \"vertical\",\r\n                    left: \"left\",\r\n                },\r\n                series: [\r\n                    {\r\n                        name: \"次数\",\r\n                        type: \"pie\",\r\n                        radius: \"50%\",\r\n                        data: this.dataTypes,\r\n                        emphasis: {\r\n                            itemStyle: {\r\n                                shadowBlur: 10,\r\n                                shadowOffsetX: 0,\r\n                                shadowColor: \"rgba(0, 0, 0, 0.5)\",\r\n                            },\r\n                        },\r\n                    },\r\n                ],\r\n            };\r\n\r\n            option && myChart.setOption(option);\r\n        },\r\n        draw2() {\r\n            var echarts = require(\"echarts\");\r\n            var myChart = echarts.init(document.getElementById(\"chart2\"));\r\n            var option = {\r\n                title: {\r\n                    text: \"近五天缴费记录\",\r\n                    left: \"center\",\r\n                },\r\n                toolbox: {\r\n                    show: true,\r\n                    orient: \"vertical\",\r\n                    left: \"right\",\r\n                    top: \"center\",\r\n                    feature: {\r\n                        mark: { show: true },\r\n                        dataView: { show: true, readOnly: false },\r\n                        magicType: {\r\n                            show: true,\r\n                            type: [\"line\", \"bar\", \"stack\"],\r\n                        },\r\n                        restore: { show: true },\r\n                        saveAsImage: { show: true },\r\n                    },\r\n                },\r\n                xAxis: {\r\n                    type: \"category\",\r\n                    axisLabel: {\r\n                        rotate: 45,\r\n                    },\r\n                    data: this.dataMoneyName,\r\n                },\r\n                yAxis: {\r\n                    type: \"value\",\r\n                },\r\n                series: [\r\n                    {\r\n                        data: this.dataMoneyValue,\r\n                        type: \"bar\",\r\n                        showBackground: true,\r\n                        backgroundStyle: {\r\n                            color: \"rgba(180, 180, 180, 0.2)\",\r\n                        },\r\n                    },\r\n                ],\r\n            };\r\n\r\n            option && myChart.setOption(option);\r\n        },\r\n        editCommit(formName) {\r\n            this.$refs[formName].validate((valid) => {\r\n                if (valid) {\r\n                    this.editUser.uid = this.userInfo.uid;\r\n                    axios\r\n                        .post(\"/api/user/updateByUser\", this.editUser)\r\n                        .then((res) => {\r\n                            if (res.data.data) {\r\n                                this.$message.success(\"修改成功！\");\r\n                                this.getUserInfo(this.userInfo.uid);\r\n                            } else {\r\n                                this.$message.error(\"修改失败！\");\r\n                            }\r\n                            this.editShow = false;\r\n                        });\r\n                } else {\r\n                    return false;\r\n                }\r\n            });\r\n        },\r\n        //时间转换函数\r\n        dateFormat(val, timeType) {\r\n            //将字符串或长整型转为时间类型\r\n            let date = new Date(val);\r\n            //默认格式为'年月日 时:分:秒'\r\n            let resultFormat = \"Y年M月D日 h:m:s\";\r\n            switch (timeType) {\r\n                case 1:\r\n                    resultFormat = \"Y年M月D日\";\r\n                    break;\r\n                case 2:\r\n                    resultFormat = \"Y-M-D\";\r\n                    break;\r\n                case 3:\r\n                    resultFormat = \"Y-M-D h:m:s\";\r\n                    break;\r\n            }\r\n            let result = formatTime(resultFormat);\r\n\r\n            // 格式化日期，如月、日、时、分、秒保证为2位数\r\n            function formatNumber(n) {\r\n                n = n.toString();\r\n                return n[1] ? n : \"0\" + n;\r\n            }\r\n            // 参数number为毫秒时间戳，format为需要转换成的日期格式\r\n            function formatTime(format) {\r\n                let newArr = [];\r\n                let formatArr = [\"Y\", \"M\", \"D\", \"h\", \"m\", \"s\"];\r\n                newArr.push(date.getFullYear());\r\n                newArr.push(formatNumber(date.getMonth() + 1));\r\n                newArr.push(formatNumber(date.getDate()));\r\n\r\n                newArr.push(formatNumber(date.getHours()));\r\n                newArr.push(formatNumber(date.getMinutes()));\r\n                newArr.push(formatNumber(date.getSeconds()));\r\n\r\n                for (let i in newArr) {\r\n                    format = format.replace(formatArr[i], newArr[i]);\r\n                }\r\n                return format;\r\n            }\r\n\r\n            return result;\r\n        },\r\n    },\r\n    mounted() {\r\n        const uid = window.sessionStorage.getItem(\"token\");\r\n        this.getUserInfo(uid);\r\n        // this.draw1();\r\n        // this.draw2();\r\n    },\r\n};\r\n</script>\r\n<style scoped>\r\n#myChart {\r\n    width: 500px;\r\n    height: 450px;\r\n}\r\n#chart2 {\r\n    width: 500px;\r\n    height: 450px;\r\n}\r\n.h2-text {\r\n    color: rgb(70, 70, 70);\r\n    font-size: 18px;\r\n    text-align: center;\r\n}\r\n.data-text {\r\n    width: 100%;\r\n    height: 150px;\r\n    line-height: 150px;\r\n    text-align: center;\r\n    color: rgb(203, 199, 199);\r\n    font-size: 24px;\r\n}\r\n</style>"]}]}